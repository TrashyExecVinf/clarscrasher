local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

local RUNNING = false
local threads = {}
local connections = {}

-- // CONFIGURATION
local PERMANENT_KEY = "clar-ap" 
local DISCORD_INVITE = "https://discord.gg/8fepRqK7CH"

-- // DAILY KEY GENERATOR
local function getDailyKey()
    local date = os.date("!*t") -- UTC Time
    return "clar-" .. date.day .. date.month -- Generates e.g. clar-3112
end
local DAILY_KEY = getDailyKey()

-- // KEY SYSTEM UI
local keyGui = Instance.new("ScreenGui")
keyGui.Name = "KeySystem_UI"
keyGui.ResetOnSpawn = false
keyGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
keyGui.Parent = game:GetService("CoreGui")

local keyFrame = Instance.new("Frame", keyGui)
keyFrame.Size = UDim2.fromOffset(300, 200)
keyFrame.Position = UDim2.new(0.5, -150, 0.5, -100)
keyFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
keyFrame.BorderSizePixel = 0
Instance.new("UICorner", keyFrame).CornerRadius = UDim.new(0, 10)

local keyTitle = Instance.new("TextLabel", keyFrame)
keyTitle.Size = UDim2.new(1, 0, 0, 40)
keyTitle.Position = UDim2.fromOffset(0, 10)
keyTitle.BackgroundTransparency = 1
keyTitle.Text = "CLAR'S AUTH"
keyTitle.Font = Enum.Font.GothamBold
keyTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
keyTitle.TextSize = 18

local keyInput = Instance.new("TextBox", keyFrame)
keyInput.Size = UDim2.new(0, 200, 0, 30)
keyInput.Position = UDim2.new(0.5, -100, 0, 70)
keyInput.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
keyInput.BorderSizePixel = 0
keyInput.PlaceholderText = "Enter Key"
keyInput.Font = Enum.Font.Gotham
keyInput.Text = ""
keyInput.TextColor3 = Color3.fromRGB(255, 255, 255)
keyInput.TextSize = 14
Instance.new("UICorner", keyInput).CornerRadius = UDim.new(0, 6)

local confirmBtn = Instance.new("TextButton", keyFrame)
confirmBtn.Size = UDim2.new(0, 200, 0, 30)
confirmBtn.Position = UDim2.new(0.5, -100, 0, 110)
confirmBtn.BackgroundColor3 = Color3.fromRGB(255, 0, 100)
confirmBtn.BorderSizePixel = 0
confirmBtn.Text = "Confirm"
confirmBtn.Font = Enum.Font.GothamBold
confirmBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
confirmBtn.TextSize = 14
Instance.new("UICorner", confirmBtn).CornerRadius = UDim.new(0, 6)

local discordBtn = Instance.new("TextButton", keyFrame)
discordBtn.Size = UDim2.new(0, 200, 0, 30)
discordBtn.Position = UDim2.new(0.5, -100, 0, 150)
discordBtn.BackgroundColor3 = Color3.fromRGB(58, 137, 219)
discordBtn.BorderSizePixel = 0
discordBtn.Text = "Copy Discord Link"
discordBtn.Font = Enum.Font.GothamBold
discordBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
discordBtn.TextSize = 14
Instance.new("UICorner", discordBtn).CornerRadius = UDim.new(0, 6)

-- // MAIN UI CONSTRUCTION
local gui = Instance.new("ScreenGui")
gui.Name = "ClarsCrasher_UI"
gui.ResetOnSpawn = false
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
gui.Parent = game:GetService("CoreGui")
gui.Enabled = false 

local main = Instance.new("Frame", gui)
main.Size = UDim2.fromOffset(280, 50)
main.Position = UDim2.new(0.5, -140, 0.85, 0)
main.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
main.BorderSizePixel = 0
main.Active = true
Instance.new("UICorner", main).CornerRadius = UDim.new(0, 10)

local stroke = Instance.new("UIStroke", main)
stroke.Color = Color3.fromRGB(255, 0, 100)
stroke.Thickness = 2
stroke.Transparency = 0.2

local label = Instance.new("TextLabel", main)
label.Size = UDim2.new(1, -100, 1, 0)
label.Position = UDim2.fromOffset(15, 0)
label.BackgroundTransparency = 1
label.Text = "CLAR'S CRASHER"
label.Font = Enum.Font.GothamBold
label.TextColor3 = Color3.fromRGB(255, 255, 255)
label.TextSize = 14
label.TextXAlignment = Enum.TextXAlignment.Left

local statusBox = Instance.new("Frame", main)
statusBox.Size = UDim2.fromOffset(80, 26)
statusBox.Position = UDim2.new(1, -90, 0.5, -13)
statusBox.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
Instance.new("UICorner", statusBox).CornerRadius = UDim.new(0, 6)

local click = Instance.new("TextButton", statusBox)
click.Size = UDim2.fromScale(1, 1)
click.BackgroundTransparency = 1
click.Text = "OFF"
click.TextColor3 = Color3.fromRGB(255, 0, 100)
click.Font = Enum.Font.GothamBold
click.TextSize = 11

-- // SMOOTH DRAGGING
local dragging, dragStart, startPos
main.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = main.Position
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

main.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

-- // LOGIC FUNCTIONS
local function anticrashSkid(player)
    local function anticrashChar(char)
        local hum = char:WaitForChild("Humanoid", 5)
        local anim = hum and hum:WaitForChild("Animator", 5)
        if not anim then return end

        table.insert(connections,
            anim.AnimationPlayed:Connect(function(track)
                track:AdjustSpeed(-math.huge)
                track:Stop()
            end)
        )

        for _, v in anim:GetPlayingAnimationTracks() do
            v:AdjustSpeed(-math.huge)
            v:Stop()
        end
    end

    table.insert(connections, player.CharacterAdded:Connect(anticrashChar))
    if player.Character then anticrashChar(player.Character) end
end

local function start()
    if RUNNING then return end
    RUNNING = true

    label.Text = "CLAR'S CRASHER "
    label.TextColor3 = Color3.fromRGB(0,255,160)
    stroke.Color = Color3.fromRGB(0,255,160)

    for _, v in Players:GetPlayers() do
        if v ~= LocalPlayer then
            anticrashSkid(v)
        end
    end

    table.insert(connections, Players.PlayerAdded:Connect(anticrashSkid))

    table.insert(threads, task.spawn(function()
        while RUNNING do
            task.wait()
            for i = 1, 50 do
                local anim = Instance.new("Animation")
                anim.AnimationId =
                    "http" .. HttpService:GenerateGUID() .. "=113437017590496"

                pcall(function()
                    local char = LocalPlayer.Character
                    local hum = char and char:FindFirstChild("Humanoid")
                    local animator = hum and hum:FindFirstChild("Animator")
                    if not animator then return end

                    local track = animator:LoadAnimation(anim)
                    track:Play(2147483647)
                    RunService.PreRender:Wait()
                    track:AdjustSpeed(-math.huge)
                end)
            end
        end
    end))
end


local function stop()
    RUNNING = false
    click.Text = "OFF"
    click.TextColor3 = Color3.fromRGB(255, 0, 100)
    stroke.Color = Color3.fromRGB(255, 0, 100)
    
    for _, c in connections do
        pcall(function() c:Disconnect() end)
    end
    table.clear(connections)
    
    for _, t in threads do
        task.cancel(t)
    end
    table.clear(threads)
end

-- // BUTTON CONNECTIONS
click.MouseButton1Click:Connect(function()
    if RUNNING then stop() else start() end
end)

confirmBtn.MouseButton1Click:Connect(function()
    local userKey = keyInput.Text
    if userKey == PERMANENT_KEY or userKey == DAILY_KEY then
        keyGui:Destroy()
        gui.Enabled = true
    else
        confirmBtn.Text = "Invalid Key!"
        task.wait(1)
        confirmBtn.Text = "Confirm"
    end
end)

discordBtn.MouseButton1Click:Connect(function()
    if setclipboard then
        setclipboard(DISCORD_INVITE)
        discordBtn.Text = "Copied!"
        task.wait(1)
        discordBtn.Text = "Copy Discord Link"
    else
        discordBtn.Text = "Unsupported Exec"
    end
end)
